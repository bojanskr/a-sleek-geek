---
layout: post
title: Providing a File for Download trough a Save As Dialog in ASP.NET
date: 2015-03-12 19:20:27.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- ASP.NET
- WEB
tags:
- ".NET"
meta:
  _wpas_skip_10664490: '1'
  _rest_api_client_id: "-1"
  _rest_api_published: '1'
  _import_session_id: 5f57b340a397b
  _import_original_post_id: '60'
  original_post_id: '1655'
  _wp_old_slug: '1655'
author:
  login: bojanskr
  email: bojanskr@gmail.com
  display_name: TehBoyan
  first_name: Bojan
  last_name: Skrchevski
permalink: "/2015/03/12/providing-a-file-for-download-trough-a-save-as-dialog-in-asp-net/"
---
<p><!-- wp:paragraph --></p>
<p>The question of providing a file trough a SaveAs dialog in a web browser&nbsp;appears very often in the forums and QA websites like Stackoverflow.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>The default action of the web browser when a file is provided is to open it.<br />
It automatically determines the file type and opens it inside the browser. An&nbsp;example would be a link to a .pdf, an excel or image file etc. When you click on it it opens&nbsp;the file in another tab or another page.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>You have two options to achieve this depending whether you are using an already existing file or you are&nbsp;dynamically generating it(or getting it from a database or such).</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:more --><br />
<!--more--><br />
<!-- /wp:more --></p>
<p><!-- wp:paragraph --></p>
<p>The first alternative is to use <span class="auto-style1"><a href="http://msdn.microsoft.com/en-us/library/12s31dhy(v=vs.100).aspx">HttpResponse.TransmitFile</a></span> method to send the file to a response.&nbsp;Which will display the SaveAs dialog asking you for a location where to store<br />
the file. First you need to set the <span class="auto-style1">ContentType&nbsp;</span>property and add the <span class="auto-style1">Content-Disposition</span> and/or&nbsp;<span class="auto-style1">Content-Length</span> headers for the response.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Here's an example:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted {"className":"brush: csharp"} --></p>
<pre class="wp-block-preformatted brush: csharp">string filePath = "~/path/SomeExcelFile.xlsx";
System.IO.FileInfo fileInfo = new System.IO.FileInfo(filePath);
Response.Clear();
Response.AddHeader("Content-Disposition", string.Format("attachment;filename={0}", filePath));
Response.AddHeader("Content-Lenght", fileInfo.Length.ToString());
Response.ContentType = "application/ms-excel";
Response.TransmitFile(Server.MapPath(filePath));
Response.End();
</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>This will cause a SaveAs dialog to appear with the <span class="auto-style1">SomeExcelFile.xlsx</span> as the default filename.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>The transmit file approach is valid only if you are providing an existing&nbsp;file. If for example you are generating a file dynamically or reading it from a&nbsp;database you can use the <span class="auto-style1"><br />
<a href="http://msdn.microsoft.com/en-us/library/system.web.httpresponse.outputstream.aspx">HttpResponse.OutputStream</a>&nbsp;</span>property to write directly to the output stream. For example:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted {"className":"brush: csharp"} --></p>
<pre class="wp-block-preformatted brush: csharp">Bitmap bmp = new Bitmap(10, 10);
Response.ContentType = "image/jpeg";
Response.AppendHeader("Content-Disposition", "attachment; filename=bitmap.jpg");

bmp.Save(Response.OutputStream, ImageFormat.Jpeg);
</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>There is also another approach using <span class="auto-style1"><a href="http://msdn.microsoft.com/en-us/library/ms524318.aspx">Response.BinaryWrite</a></span>:</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:preformatted {"className":"brush: csharp"} --></p>
<pre class="wp-block-preformatted brush: csharp">using (DataContext db = new DataContext())
{
    var objData = (from c in db.Companies where c.CompanyId == CompanyID select c.LogoSmall).FirstOrDefault();
   
    using (System.IO.MemoryStream stream = new System.IO.MemoryStream(objData.ToArray(), true))
    {
        stream.Write(objData.ToArray(), 0, objData.ToArray().Length);
        Byte[] bytes = stream.ToArray();
        Response.ContentType = "image/jpeg";
        Response.AppendHeader("Content-Disposition", "attachment; filename=image1.jpg");
        Response.BinaryWrite(bytes);
        Response.End();
    }
}
</pre>
<p><!-- /wp:preformatted --></p>
<p><!-- wp:paragraph --></p>
<p>This will read the binary data from the database using Linq-to-Sql and will&nbsp;provide the file for saving appearing a SaveAs dialog with the<span class="auto-style1">image1.jpg</span> as the default filename.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Adding the <span class="auto-style1">Response.End()</span> can be ommited,&nbsp;but you may inadvertently be sending other content back after&nbsp;<span class="auto-style1">Response.BinaryWrite()</span> which may confuse the&nbsp;browser. <span class="auto-style1">Response.End()</span> will ensure that that&nbsp;the browser only gets what you really intend.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Hope this helps to someone out there.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>'Till next time....Taaa daaaa.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>//Bojan</p>
<p><!-- /wp:paragraph --></p>
